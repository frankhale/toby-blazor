@page "/"

@using TobyBlazor.Models
@using TobyBlazor.Data

@inject IJSRuntime jsRuntime

<CommandInput OnSearch=@OnSearchResults />

@if (SearchResults.Count > 0)
{
    @if (Manage)
    {
        <VideoManagement />
    }
    else
    {
        <VideoList Videos=@SearchResults />
    }
}

@code {
    private readonly IVideoRepository videos = new VideoRepository();

    public List<Video> SearchResults = new List<Video>();
    public bool Manage = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await jsRuntime.InvokeVoidAsync("setModalCloseStopVideo", "ytModal");
        }
    }

    public void OnSearchResults(SearchResult result)
    {
        SearchResults = result.Videos;
        Manage = result.Manage;
    }
}
