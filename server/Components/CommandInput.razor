@namespace TobyBlazor.Components

@using TobyBlazor.Data
@using TobyBlazor.Models

@inject IJSRuntime jsRuntime

<input type="text" class="form-control" id="commandInput" placeholder="Search..."
       @onchange=@(newValue => CommandChanged(newValue.Value.ToString()))
       onchange-prevent-default />

@code {
    private readonly IVideoRepository videos = new VideoRepository();

    [Parameter]
    public EventCallback<SearchResult> OnSearch { get; set; }

    private async void CommandChanged(string term)
    {
        var result = new SearchResult();

        if (term.StartsWith("/manage") || term.StartsWith("/mg"))
        {
            result.Manage = true;
            result.Videos = videos.AllVideos();
        }
        else
        {
            result.Manage = false;
            result.Videos = await videos.Search(term);
        }
        
        await OnSearch.InvokeAsync(result);
    }
}
